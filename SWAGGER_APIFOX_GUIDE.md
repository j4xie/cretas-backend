# Swaggerå’ŒApifoxä½¿ç”¨å®Œæ•´æŒ‡å—

**é¡¹ç›®**: Cretas Food Traceability System
**APIç‰ˆæœ¬**: 1.0.0
**æ›´æ–°æ—¥æœŸ**: 2025-11-01

---

## ğŸ“š ç›®å½•

1. [Swaggeré…ç½®æ¦‚è§ˆ](#swaggeré…ç½®æ¦‚è§ˆ)
2. [Swagger UIä½¿ç”¨](#swagger-uiä½¿ç”¨)
3. [Apifoxé›†æˆæ–¹æ¡ˆ](#apifoxé›†æˆæ–¹æ¡ˆ)
4. [APIæµ‹è¯•ç¤ºä¾‹](#apiæµ‹è¯•ç¤ºä¾‹)
5. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## ğŸ“Š Swaggeré…ç½®æ¦‚è§ˆ

### å½“å‰é…ç½®

æ ¹æ®é¡¹ç›®é…ç½®ï¼ŒSwagger/OpenAPIå·²å®Œæ•´é…ç½®ï¼š

**é…ç½®æ–‡ä»¶**: `src/main/java/com/cretas/aims/config/SwaggerConfig.java`
**ä¾èµ–ç‰ˆæœ¬**: SpringDoc OpenAPI UI 1.7.0

### APIæ–‡æ¡£ä¿¡æ¯

| é¡¹ç›® | å€¼ |
|-----|---|
| **æ ‡é¢˜** | ç™½å©çºªé£Ÿå“æº¯æºç³»ç»Ÿ API æ–‡æ¡£ |
| **æè¿°** | Cretas Food Traceability System - RESTful API Documentation |
| **ç‰ˆæœ¬** | 1.0.0 |
| **è”ç³»äºº** | Cretas Team (support@cretas.com) |
| **è®¸å¯è¯** | MIT License |
| **è®¤è¯æ–¹å¼** | Bearer Token (JWT) |

### è®¿é—®ç«¯ç‚¹

æœåŠ¡å¯åŠ¨åå¯è®¿é—®ä»¥ä¸‹ç«¯ç‚¹ï¼š

| ç«¯ç‚¹ç±»å‹ | URL | è¯´æ˜ |
|---------|-----|------|
| **Swagger UI** | http://106.14.165.234:10010/swagger-ui.html | Webç•Œé¢ |
| **OpenAPI JSON** | http://106.14.165.234:10010/v3/api-docs | JSONæ ¼å¼ |
| **OpenAPI YAML** | http://106.14.165.234:10010/v3/api-docs.yaml | YAMLæ ¼å¼ |

---

## ğŸŒ Swagger UIä½¿ç”¨

### è®¿é—®Swagger UI

1. **å¯åŠ¨æœåŠ¡**
   ```bash
   # ç¡®ä¿æœåŠ¡æ­£åœ¨è¿è¡Œ
   curl http://106.14.165.234:10010/v3/api-docs
   ```

2. **æ‰“å¼€æµè§ˆå™¨**
   ```
   http://106.14.165.234:10010/swagger-ui.html
   ```

3. **æŸ¥çœ‹APIæ–‡æ¡£**
   - æ‰€æœ‰APIæŒ‰Controlleråˆ†ç»„æ˜¾ç¤º
   - æ¯ä¸ªAPIæ˜¾ç¤ºè¯·æ±‚å‚æ•°ã€å“åº”æ ¼å¼ã€çŠ¶æ€ç ç­‰

### JWTè®¤è¯è®¾ç½®

å¤§å¤šæ•°APIéœ€è¦JWTè®¤è¯ï¼Œè®¾ç½®æ­¥éª¤ï¼š

1. **è·å–Token**
   - é¦–å…ˆè°ƒç”¨ç™»å½•APIè·å–JWT token
   - ç«¯ç‚¹: `POST /api/mobile/auth/unified-login`
   - è¯·æ±‚ä½“:
     ```json
     {
       "username": "admin",
       "password": "123456"
     }
     ```

2. **é…ç½®è®¤è¯**
   - ç‚¹å‡»Swagger UIå³ä¸Šè§’ **"Authorize"** æŒ‰é’®
   - åœ¨å¼¹å‡ºçª—å£ä¸­è¾“å…¥JWT tokenï¼ˆ**ä¸éœ€è¦** "Bearer" å‰ç¼€ï¼‰
   - ç‚¹å‡» **"Authorize"**
   - ç‚¹å‡» **"Close"**

3. **æµ‹è¯•API**
   - ç°åœ¨å¯ä»¥æµ‹è¯•éœ€è¦è®¤è¯çš„API
   - æ¯ä¸ªè¯·æ±‚ä¼šè‡ªåŠ¨å¸¦ä¸Š `Authorization: Bearer <token>` å¤´

### æµ‹è¯•API

1. **é€‰æ‹©APIç«¯ç‚¹**
   - å±•å¼€æƒ³è¦æµ‹è¯•çš„APIåˆ†ç»„
   - ç‚¹å‡»å…·ä½“çš„APIç«¯ç‚¹

2. **å¡«å†™å‚æ•°**
   - Pathå‚æ•°ï¼šç›´æ¥åœ¨URLä¸­å¡«å†™
   - Queryå‚æ•°ï¼šåœ¨Parameterséƒ¨åˆ†å¡«å†™
   - Bodyå‚æ•°ï¼šåœ¨Request bodyéƒ¨åˆ†å¡«å†™JSON

3. **æ‰§è¡Œè¯·æ±‚**
   - ç‚¹å‡» **"Try it out"** æŒ‰é’®
   - ä¿®æ”¹å‚æ•°å€¼
   - ç‚¹å‡» **"Execute"** æŒ‰é’®

4. **æŸ¥çœ‹å“åº”**
   - Response body: JSONå“åº”å†…å®¹
   - Response headers: HTTPå“åº”å¤´
   - Response code: HTTPçŠ¶æ€ç 

---

## ğŸ“± Apifoxé›†æˆæ–¹æ¡ˆ

### æ–¹æ¡ˆ1: ç›´æ¥å¯¼å…¥OpenAPIè§„èŒƒï¼ˆæ¨èï¼‰

#### æ­¥éª¤1: ä¸‹è½½OpenAPI JSON

**åœ¨æœåŠ¡å™¨ä¸Š**:
```bash
# æ–¹å¼A: ä½¿ç”¨curl
curl http://106.14.165.234:10010/v3/api-docs > cretas-openapi.json

# æ–¹å¼B: ä½¿ç”¨wget
wget -O cretas-openapi.json http://106.14.165.234:10010/v3/api-docs

# ä¸‹è½½åˆ°æœ¬åœ°
scp root@106.14.165.234:/path/to/cretas-openapi.json ~/Downloads/
```

**åœ¨æœ¬åœ°**:
```bash
# ç›´æ¥ä¸‹è½½
curl http://106.14.165.234:10010/v3/api-docs > cretas-openapi.json
```

#### æ­¥éª¤2: å¯¼å…¥åˆ°Apifox

1. **æ‰“å¼€Apifox**
   - åˆ›å»ºæ–°é¡¹ç›®æˆ–é€‰æ‹©ç°æœ‰é¡¹ç›®

2. **å¯¼å…¥æ•°æ®**
   - ç‚¹å‡»é¡¶éƒ¨èœå• **"é¡¹ç›®è®¾ç½®"** -> **"å¯¼å…¥æ•°æ®"**
   - æˆ–ç›´æ¥ç‚¹å‡» **"å¯¼å…¥"** æŒ‰é’®

3. **é€‰æ‹©å¯¼å…¥æ–¹å¼**
   - æ•°æ®æ ¼å¼: **OpenAPI/Swagger**
   - å¯¼å…¥æ–¹å¼:
     - **URLå¯¼å…¥**: è¾“å…¥ `http://106.14.165.234:10010/v3/api-docs`
     - **æ–‡ä»¶å¯¼å…¥**: ä¸Šä¼ ä¸‹è½½çš„ `cretas-openapi.json`

4. **é…ç½®å¯¼å…¥é€‰é¡¹**
   - âœ… å¯¼å…¥æ¥å£
   - âœ… å¯¼å…¥æ•°æ®æ¨¡å‹
   - âœ… è¦†ç›–å·²å­˜åœ¨çš„æ¥å£ï¼ˆå¦‚æœéœ€è¦æ›´æ–°ï¼‰
   - ç‚¹å‡» **"ç¡®å®š"**

5. **éªŒè¯å¯¼å…¥ç»“æœ**
   - æ£€æŸ¥æ¥å£æ•°é‡
   - æ£€æŸ¥åˆ†ç»„ç»“æ„
   - æµ‹è¯•å‡ ä¸ªæ¥å£

### æ–¹æ¡ˆ2: è‡ªåŠ¨åŒæ­¥ï¼ˆæŒç»­æ›´æ–°ï¼‰

1. **é…ç½®æ•°æ®åŒæ­¥**
   - é¡¹ç›®è®¾ç½® -> **"æ•°æ®åŒæ­¥"**
   - ç‚¹å‡» **"æ·»åŠ æ•°æ®æº"**

2. **æ·»åŠ OpenAPIæ•°æ®æº**
   - æ•°æ®æºç±»å‹: **OpenAPI**
   - URL: `http://106.14.165.234:10010/v3/api-docs`
   - åŒæ­¥æ–¹å¼:
     - **è‡ªåŠ¨åŒæ­¥**: è®¾ç½®å®šæ—¶ï¼ˆå¦‚æ¯å°æ—¶ï¼‰
     - **æ‰‹åŠ¨åŒæ­¥**: éœ€è¦æ—¶ç‚¹å‡»åŒæ­¥æŒ‰é’®

3. **åŒæ­¥è§„åˆ™**
   - å¯¼å…¥æ¨¡å¼: è¦†ç›–æ¨¡å¼ / å¢é‡æ¨¡å¼
   - æ¥å£åˆ†ç»„: ä¿æŒæºç»“æ„
   - æ•°æ®æ¨¡å‹: åŒæ­¥

4. **ä¿å­˜å¹¶åŒæ­¥**
   - ç‚¹å‡» **"ä¿å­˜"**
   - ç‚¹å‡» **"ç«‹å³åŒæ­¥"** è¿›è¡Œé¦–æ¬¡åŒæ­¥

### æ–¹æ¡ˆ3: æ‰‹åŠ¨åˆ›å»ºï¼ˆå°å‹é¡¹ç›®ï¼‰

å¦‚æœAPIæ•°é‡ä¸å¤šï¼Œå¯ä»¥æ‰‹åŠ¨åœ¨Apifoxä¸­åˆ›å»ºï¼š

1. å‚è€ƒSwagger UIä¸­çš„APIå®šä¹‰
2. åœ¨Apifoxä¸­æ‰‹åŠ¨åˆ›å»ºæ¥å£
3. é…ç½®è¯·æ±‚å‚æ•°å’Œå“åº”ç¤ºä¾‹

---

## ğŸ§ª APIæµ‹è¯•ç¤ºä¾‹

### ç¤ºä¾‹1: ç”¨æˆ·ç™»å½•

**Swagger UIæµ‹è¯•**:

1. æ‰¾åˆ°æ¥å£: `POST /api/mobile/auth/unified-login`
2. ç‚¹å‡» "Try it out"
3. å¡«å†™è¯·æ±‚ä½“:
```json
{
  "username": "admin",
  "password": "123456"
}
```
4. ç‚¹å‡» "Execute"
5. æŸ¥çœ‹å“åº”ï¼ˆåº”åŒ…å«tokenï¼‰

**Apifoxæµ‹è¯•**:

1. æ‰¾åˆ° "ç»Ÿä¸€ç™»å½•" æ¥å£
2. å¡«å†™Body:
```json
{
  "username": "admin",
  "password": "123456"
}
```
3. ç‚¹å‡» "å‘é€"
4. ä¿å­˜tokenç”¨äºåç»­è¯·æ±‚

### ç¤ºä¾‹2: è·å–ç”¨æˆ·ä¿¡æ¯ï¼ˆéœ€è¦è®¤è¯ï¼‰

**å‰æ**: å·²é…ç½®Bearer Token

**Swagger UIæµ‹è¯•**:

1. ç¡®ä¿å·²ç‚¹å‡» "Authorize" å¹¶è¾“å…¥token
2. æ‰¾åˆ°æ¥å£: `GET /api/auth/profile`
3. ç‚¹å‡» "Try it out"
4. ç‚¹å‡» "Execute"
5. æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯å“åº”

**Apifoxæµ‹è¯•**:

1. é…ç½®è®¤è¯:
   - Authç±»å‹: Bearer Token
   - Token: <ä»ç™»å½•è·å¾—çš„token>
2. å‘é€è¯·æ±‚
3. æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯

### ç¤ºä¾‹3: åˆ›å»ºææ–™æ‰¹æ¬¡

**è¯·æ±‚ç¤ºä¾‹**:
```json
{
  "factoryId": "CRETAS_2024_001",
  "materialTypeId": 1,
  "supplierId": 1,
  "batchNumber": "BATCH-2024-001",
  "quantity": 1000,
  "unit": "kg",
  "purchaseDate": "2024-01-15",
  "expiryDate": "2024-12-31",
  "purchasePrice": 50.00,
  "storageLocation": "ä»“åº“A-01",
  "qualityStatus": "pending",
  "notes": "ä¼˜è´¨åŸæ–™"
}
```

---

## ğŸ”§ Apifoxç¯å¢ƒé…ç½®

### åˆ›å»ºç¯å¢ƒ

1. **é¡¹ç›®è®¾ç½®** -> **ç¯å¢ƒç®¡ç†**

2. **å¼€å‘ç¯å¢ƒ**:
```
åç§°: å¼€å‘ç¯å¢ƒ
å‰ç½®URL: http://106.14.165.234:10010
å˜é‡:
  - baseUrl: http://106.14.165.234:10010
  - token: (ä»ç™»å½•è·å–)
```

3. **ç”Ÿäº§ç¯å¢ƒ**:
```
åç§°: ç”Ÿäº§ç¯å¢ƒ
å‰ç½®URL: http://47.251.121.76:10010
å˜é‡:
  - baseUrl: http://47.251.121.76:10010
  - token: (ä»ç™»å½•è·å–)
```

### ä½¿ç”¨ç¯å¢ƒå˜é‡

åœ¨æ¥å£ä¸­ä½¿ç”¨å˜é‡:
```
URL: {{baseUrl}}/api/mobile/auth/unified-login
Headers:
  Authorization: Bearer {{token}}
```

### è‡ªåŠ¨è®¾ç½®Token

åœ¨ç™»å½•æ¥å£çš„ **åç½®æ“ä½œ** ä¸­æ·»åŠ è„šæœ¬:

```javascript
// æå–å“åº”ä¸­çš„tokenå¹¶ä¿å­˜åˆ°ç¯å¢ƒå˜é‡
const response = pm.response.json();
if (response.success && response.tokens) {
    pm.environment.set("token", response.tokens.token || response.tokens.accessToken);
    console.log("Tokenå·²ä¿å­˜:", pm.environment.get("token"));
}
```

---

## ğŸ“‹ APIåˆ†ç»„è¯´æ˜

æ ¹æ®é¡¹ç›®ç»“æ„ï¼ŒAPIåˆ†ä¸ºä»¥ä¸‹åˆ†ç»„ï¼š

### 1. è®¤è¯æ¨¡å— (Auth)
- `/api/mobile/auth/*` - ç§»åŠ¨ç«¯è®¤è¯
- `/api/auth/*` - Webç«¯è®¤è¯
- åŒ…å«: ç™»å½•ã€æ³¨å†Œã€å¯†ç ç®¡ç†ç­‰

### 2. ç”¨æˆ·ç®¡ç† (Users)
- `/api/users/*` - ç”¨æˆ·CRUD
- `/api/mobile/users/*` - ç§»åŠ¨ç«¯ç”¨æˆ·

### 3. ææ–™ç®¡ç† (Materials)
- `/api/materials/*` - ææ–™ç±»å‹
- `/api/material-batches/*` - ææ–™æ‰¹æ¬¡

### 4. ç”Ÿäº§ç®¡ç† (Production)
- `/api/production-plans/*` - ç”Ÿäº§è®¡åˆ’
- `/api/processing/*` - åŠ å·¥è®°å½•

### 5. è´¨æ£€ç®¡ç† (Quality)
- `/api/quality/*` - è´¨æ£€è®°å½•

### 6. ä¾›åº”å•†/å®¢æˆ· (Partners)
- `/api/suppliers/*` - ä¾›åº”å•†ç®¡ç†
- `/api/customers/*` - å®¢æˆ·ç®¡ç†

### 7. ç³»ç»Ÿç®¡ç† (System)
- `/api/whitelist/*` - ç™½åå•
- `/api/work-types/*` - å·¥ç§ç®¡ç†
- `/api/factory-settings/*` - å·¥å‚è®¾ç½®

---

## â“ å¸¸è§é—®é¢˜

### Q1: Swagger UIæ— æ³•è®¿é—®ï¼Ÿ

**æ£€æŸ¥æ¸…å•**:
```bash
# 1. ç¡®è®¤æœåŠ¡æ­£åœ¨è¿è¡Œ
curl http://localhost:10010/v3/api-docs

# 2. æ£€æŸ¥ç«¯å£
netstat -tlnp | grep 10010

# 3. æ£€æŸ¥é˜²ç«å¢™
firewall-cmd --list-ports
# æ·»åŠ ç«¯å£ï¼ˆå¦‚éœ€è¦ï¼‰
firewall-cmd --permanent --add-port=10010/tcp
firewall-cmd --reload

# 4. æ£€æŸ¥æ—¥å¿—
tail -f /www/wwwroot/cretas/cretas-backend.log
```

### Q2: Apifoxå¯¼å…¥åæ¥å£æ•°é‡ä¸å¯¹ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥OpenAPI JSONæ–‡ä»¶æ˜¯å¦å®Œæ•´ä¸‹è½½
2. ç¡®è®¤æœåŠ¡å™¨ä¸Šæ‰€æœ‰Controlleréƒ½æœ‰æ­£ç¡®çš„æ³¨è§£
3. é‡æ–°å¯¼å…¥ï¼Œé€‰æ‹©"è¦†ç›–æ¨¡å¼"
4. æ£€æŸ¥Apifoxå¯¼å…¥æ—¥å¿—

### Q3: 401 Unauthorizedé”™è¯¯ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®è®¤tokenæ˜¯å¦æ­£ç¡®è®¾ç½®
2. æ£€æŸ¥tokenæ˜¯å¦è¿‡æœŸï¼ˆé»˜è®¤24å°æ—¶ï¼‰
3. é‡æ–°ç™»å½•è·å–æ–°token
4. ç¡®è®¤Authorizationå¤´æ ¼å¼: `Bearer <token>`

### Q4: å¦‚ä½•æ›´æ–°Apifoxä¸­çš„APIï¼Ÿ

**æ–¹æ¡ˆA - è‡ªåŠ¨åŒæ­¥**:
- é…ç½®äº†è‡ªåŠ¨åŒæ­¥çš„é¡¹ç›®ä¼šå®šæ—¶æ›´æ–°

**æ–¹æ¡ˆB - æ‰‹åŠ¨åŒæ­¥**:
1. é¡¹ç›®è®¾ç½® -> æ•°æ®åŒæ­¥
2. æ‰¾åˆ°OpenAPIæ•°æ®æº
3. ç‚¹å‡»"ç«‹å³åŒæ­¥"

**æ–¹æ¡ˆC - é‡æ–°å¯¼å…¥**:
1. ä¸‹è½½æœ€æ–°çš„OpenAPI JSON
2. é¡¹ç›®è®¾ç½® -> å¯¼å…¥æ•°æ®
3. é€‰æ‹©"è¦†ç›–å·²å­˜åœ¨çš„æ¥å£"

### Q5: å¦‚ä½•å¯¼å‡ºApifoxæ•°æ®ï¼Ÿ

åœ¨Apifoxä¸­:
1. é¡¹ç›®è®¾ç½® -> å¯¼å‡ºæ•°æ®
2. é€‰æ‹©å¯¼å‡ºæ ¼å¼:
   - OpenAPI 3.0
   - Postman Collection
   - Markdownæ–‡æ¡£
3. å¯¼å‡ºå¹¶ä¿å­˜

---

## ğŸ¯ æœ€ä½³å®è·µ

### Swagger UIæœ€ä½³å®è·µ

1. **ä½¿ç”¨ç¯å¢ƒ**
   - å¼€å‘ç¯å¢ƒä½¿ç”¨å¼€å‘æœåŠ¡å™¨
   - ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ç”Ÿäº§æœåŠ¡å™¨

2. **Tokenç®¡ç†**
   - å®šæœŸåˆ·æ–°token
   - ä¸è¦åœ¨å…¬å…±ç¯å¢ƒä¸­æ³„éœ²token

3. **APIæµ‹è¯•é¡ºåº**
   - å…ˆæµ‹è¯•ç™»å½•è·å–token
   - å†æµ‹è¯•éœ€è¦è®¤è¯çš„æ¥å£
   - æŒ‰ä¸šåŠ¡æµç¨‹æµ‹è¯•

### Apifoxæœ€ä½³å®è·µ

1. **ä½¿ç”¨MockåŠŸèƒ½**
   - å‰ç«¯å¼€å‘æ—¶ä½¿ç”¨Mockæ•°æ®
   - ä¸ä¾èµ–åç«¯æœåŠ¡

2. **ç¼–å†™æµ‹è¯•ç”¨ä¾‹**
   - ä¸ºå…³é”®APIç¼–å†™è‡ªåŠ¨åŒ–æµ‹è¯•
   - ä½¿ç”¨æ–­è¨€éªŒè¯å“åº”

3. **å›¢é˜Ÿåä½œ**
   - ä½¿ç”¨Apifoxäº‘ç«¯åŒæ­¥
   - å…±äº«ç¯å¢ƒå˜é‡å’Œæµ‹è¯•æ•°æ®

4. **ç‰ˆæœ¬ç®¡ç†**
   - å®šæœŸå¯¼å‡ºOpenAPIæ–‡ä»¶
   - ä½¿ç”¨Gitç®¡ç†APIæ–‡æ¡£ç‰ˆæœ¬

---

## ğŸ“ è·å–å¸®åŠ©

### Swaggerç›¸å…³
- å®˜æ–¹æ–‡æ¡£: https://springdoc.org/
- SpringDoc GitHub: https://github.com/springdoc/springdoc-openapi

### Apifoxç›¸å…³
- å®˜æ–¹æ–‡æ¡£: https://www.apifox.cn/help/
- è§†é¢‘æ•™ç¨‹: https://www.apifox.cn/video/

### é¡¹ç›®ç›¸å…³
- æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—: `/www/wwwroot/cretas/cretas-backend.log`
- æŸ¥çœ‹å®Œæ•´éƒ¨ç½²æŒ‡å—: `COMPILE_AND_DEPLOY_GUIDE.md`

---

**å‡†å¤‡å°±ç»ªï¼** ğŸš€

ä»£ç å·²å®Œå…¨ä¿®å¤ï¼ŒSwaggerå’ŒApifoxé…ç½®å®Œæ•´ï¼Œå¯ä»¥å¼€å§‹ä½¿ç”¨APIæ–‡æ¡£äº†ï¼
