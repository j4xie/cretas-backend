# ğŸš€ AIMSç³»ç»Ÿå¿«é€Ÿå¼€å§‹æŒ‡å—

## ğŸ“‹ 5åˆ†é’Ÿå¿«é€Ÿå¯åŠ¨

### Step 1: å®‰è£…Redisï¼ˆå¿…éœ€ï¼ï¼‰
```bash
# macOS
brew install redis
brew services start redis

# éªŒè¯Redisè¿è¡Œ
redis-cli ping
# åº”è¿”å›: PONG
```

### Step 2: åˆå§‹åŒ–æ•°æ®åº“
```bash
# è¿æ¥æ•°æ®åº“å¹¶æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬
mysql -h 47.251.121.76 -P 3307 -u root -pZyh123456 cretas < init-database.sql
```

### Step 3: å¯åŠ¨åº”ç”¨
```bash
cd /Users/eason/Documents/AIMSé¡¹ç›®/AIMS_2.0/cretas-backend-system

# æ–¹å¼1: Mavenè¿è¡Œ
mvn spring-boot:run

# æ–¹å¼2: æ‰“åŒ…è¿è¡Œ
mvn clean package -DskipTests
java -jar target/cretas-backend-system-1.0.0.jar
```

### Step 4: è®¿é—®Swaggeræµ‹è¯•
æµè§ˆå™¨æ‰“å¼€: http://localhost:10010/swagger-ui.html

---

## ğŸ§ª å¿«é€Ÿæµ‹è¯•

### æµ‹è¯•1: å¹³å°ç®¡ç†å‘˜ç™»å½•ï¼ˆæœ€ç®€å•ï¼‰

**Swaggeræµ‹è¯•:**
1. æ‰“å¼€ http://localhost:10010/swagger-ui.html
2. æ‰¾åˆ° `POST /api/auth/platform-login`
3. ç‚¹å‡» "Try it out"
4. è¾“å…¥:
```json
{
  "username": "platform_admin",
  "password": "admin123"
}
```
5. ç‚¹å‡» "Execute"
6. âœ… åº”è¯¥è¿”å›tokenå’Œç”¨æˆ·ä¿¡æ¯

**curlæµ‹è¯•:**
```bash
curl -X POST http://localhost:10010/api/auth/platform-login \
  -H "Content-Type: application/json" \
  -d '{"username":"platform_admin","password":"admin123"}'
```

---

### æµ‹è¯•2: å·¥å‚ç”¨æˆ·ç™»å½•

**å·²æœ‰æµ‹è¯•è´¦å·ï¼Œæ— éœ€æ³¨å†Œï¼**

**Swaggeræµ‹è¯•:**
1. æ‰¾åˆ° `POST /api/auth/login`
2. ç‚¹å‡» "Try it out"
3. è¾“å…¥:
```json
{
  "factoryId": "F001",
  "username": "testadmin",
  "password": "password123"
}
```
4. ç‚¹å‡» "Execute"
5. âœ… åº”è¯¥è¿”å›tokenå’Œç”¨æˆ·ä¿¡æ¯

**curlæµ‹è¯•:**
```bash
curl -X POST http://localhost:10010/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "factoryId":"F001",
    "username":"testadmin",
    "password":"password123"
  }'
```

---

### æµ‹è¯•3: ç”¨æˆ·æ³¨å†Œï¼ˆå®Œæ•´æµç¨‹ï¼‰

#### 3.1 æŸ¥çœ‹æ—¥å¿—è·å–éªŒè¯ç 

**é‡è¦**: å¼€å‘ç¯å¢ƒä¸‹ï¼ŒéªŒè¯ç ä¼šæ‰“å°åœ¨æ—¥å¿—ä¸­ï¼

**Swaggeræµ‹è¯•:**
1. æ‰¾åˆ° `POST /api/auth/send-code`
2. è¾“å…¥: `{"phoneNumber":"13800138000"}`
3. ç‚¹å‡» "Execute"
4. **æŸ¥çœ‹æœåŠ¡å™¨æ§åˆ¶å°**ï¼Œæ‰¾åˆ°ç±»ä¼¼ï¼š
```
å‘é€éªŒè¯ç åˆ°æ‰‹æœºå·: 13800138000, éªŒè¯ç : 784521 (å¼€å‘ç¯å¢ƒï¼Œæœªå®é™…å‘é€)
```
5. è®°ä½éªŒè¯ç : `784521`

#### 3.2 éªŒè¯æ‰‹æœºå·
1. æ‰¾åˆ° `POST /api/auth/verify-phone`
2. è¾“å…¥:
```json
{
  "phoneNumber": "13800138000",
  "verificationCode": "784521",
  "factoryId": "F001"
}
```
3. ç‚¹å‡» "Execute"
4. **å¤åˆ¶è¿”å›çš„tempToken**

#### 3.3 å®Œæˆæ³¨å†Œ
1. æ‰¾åˆ° `POST /api/auth/register`
2. è¾“å…¥:
```json
{
  "tempToken": "ç²˜è´´ä¸Šä¸€æ­¥çš„tempToken",
  "factoryId": "F001",
  "username": "myuser001",
  "password": "mypass123",
  "realName": "æˆ‘çš„æµ‹è¯•",
  "email": "my@test.com",
  "position": "å·¥ç¨‹å¸ˆ"
}
```
3. ç‚¹å‡» "Execute"
4. âœ… æ³¨å†ŒæˆåŠŸï¼

#### 3.4 æ¿€æ´»å¹¶ç™»å½•
```sql
-- åœ¨æ•°æ®åº“ä¸­æ¿€æ´»ç”¨æˆ·
UPDATE users
SET is_active = TRUE, role_code = 'operator'
WHERE username = 'myuser001';
```

ç„¶åä½¿ç”¨æµ‹è¯•2çš„æ–¹æ³•ç™»å½•

---

## ğŸ“š æµ‹è¯•è´¦å·

### å¹³å°ç®¡ç†å‘˜
| ç”¨æˆ·å | å¯†ç  | è§’è‰² |
|--------|------|------|
| platform_admin | admin123 | è¶…çº§ç®¡ç†å‘˜ |
| system_admin | admin123 | ç³»ç»Ÿç®¡ç†å‘˜ |
| test_admin | admin123 | å®¡è®¡å‘˜ |

### å·¥å‚ç”¨æˆ·ï¼ˆF001ï¼‰
| ç”¨æˆ·å | å¯†ç  | è§’è‰² |
|--------|------|------|
| testadmin | password123 | å·¥å‚è¶…çº§ç®¡ç†å‘˜ |
| testuser | password123 | æ“ä½œå‘˜ |
| testoperator | password123 | æ“ä½œå‘˜ |

### ç™½åå•æ‰‹æœºå·ï¼ˆç”¨äºæ³¨å†Œï¼‰
- 13800138000ï¼ˆå¼ ä¸‰ - F001ï¼‰
- 13800138001ï¼ˆæå›› - F001ï¼‰
- 13800138002ï¼ˆç‹äº” - F001ï¼‰

---

## ğŸ” åŠŸèƒ½æ£€æŸ¥æ¸…å•

å¯åŠ¨åº”ç”¨åï¼Œæ£€æŸ¥ä»¥ä¸‹åŠŸèƒ½ï¼š

### âœ… åŸºç¡€åŠŸèƒ½
- [ ] åº”ç”¨æˆåŠŸå¯åŠ¨ï¼ˆç«¯å£10010ï¼‰
- [ ] Swagger UIå¯è®¿é—®
- [ ] å¥åº·æ£€æŸ¥é€šè¿‡: `curl http://localhost:10010/actuator/health`

### âœ… ç™»å½•åŠŸèƒ½
- [ ] å¹³å°ç®¡ç†å‘˜ç™»å½•æˆåŠŸ
- [ ] å·¥å‚ç”¨æˆ·ç™»å½•æˆåŠŸ
- [ ] é”™è¯¯å¯†ç è¢«æ‹’ç»
- [ ] æœªæ¿€æ´»ç”¨æˆ·è¢«æ‹’ç»

### âœ… æ³¨å†ŒåŠŸèƒ½
- [ ] å‘é€éªŒè¯ç æˆåŠŸï¼ˆæ—¥å¿—ä¸­çœ‹åˆ°éªŒè¯ç ï¼‰
- [ ] éªŒè¯æ‰‹æœºå·æˆåŠŸï¼ˆè¿”å›tempTokenï¼‰
- [ ] ç”¨æˆ·æ³¨å†ŒæˆåŠŸ
- [ ] ç™½åå•éªŒè¯ç”Ÿæ•ˆ
- [ ] ä¸´æ—¶ä»¤ç‰Œè¿‡æœŸéªŒè¯ç”Ÿæ•ˆ

### âœ… è®¤è¯åŠŸèƒ½
- [ ] å¸¦tokenè®¿é—®å—ä¿æŠ¤æ¥å£æˆåŠŸ
- [ ] ä¸å¸¦tokenè®¿é—®å—ä¿æŠ¤æ¥å£è¢«æ‹’ç»ï¼ˆ401ï¼‰
- [ ] æ— æ•ˆtokenè¢«æ‹’ç»
- [ ] è·å–ç”¨æˆ·ä¿¡æ¯æˆåŠŸ

---

## â— å¸¸è§é—®é¢˜å¿«é€Ÿè§£å†³

### Redisè¿æ¥å¤±è´¥
```bash
brew services start redis
```

### ç«¯å£è¢«å ç”¨
```bash
# ä¿®æ”¹ application.yml ä¸­çš„ç«¯å£
server.port: 10011
```

### éªŒè¯ç åœ¨å“ªé‡Œï¼Ÿ
**æŸ¥çœ‹æœåŠ¡å™¨æ§åˆ¶å°æ—¥å¿—ï¼** ä¼šæ‰“å°ï¼š
```
å‘é€éªŒè¯ç åˆ°æ‰‹æœºå·: xxx, éªŒè¯ç : 123456
```

### ç”¨æˆ·ç™»å½•å¤±è´¥ - è´¦å·æœªæ¿€æ´»
```sql
UPDATE users SET is_active = TRUE WHERE username = 'ä½ çš„ç”¨æˆ·å';
```

### ç™½åå•ä¸å­˜åœ¨
ç¡®ä¿æ‰§è¡Œäº† `init-database.sql`

---

## ğŸ“– è¯¦ç»†æ–‡æ¡£

éœ€è¦æ›´è¯¦ç»†çš„æµ‹è¯•æµç¨‹ï¼Ÿè¯·æŸ¥çœ‹:
- **[æµ‹è¯•æµç¨‹æ–‡æ¡£.md](æµ‹è¯•æµç¨‹æ–‡æ¡£.md)** - å®Œæ•´çš„æµ‹è¯•æ­¥éª¤
- **[åŠŸèƒ½å¯¹æ¯”æ£€æŸ¥æŠ¥å‘Š.md](åŠŸèƒ½å¯¹æ¯”æ£€æŸ¥æŠ¥å‘Š.md)** - åŠŸèƒ½å®Œæ•´æ€§å¯¹æ¯”

---

## ğŸ‰ å¿«é€ŸéªŒè¯æˆåŠŸ

å¦‚æœä½ èƒ½ï¼š
1. âœ… ä½¿ç”¨ `platform_admin/admin123` ç™»å½•æˆåŠŸ
2. âœ… ä½¿ç”¨ `testadmin/password123` ç™»å½•æˆåŠŸ
3. âœ… æ³¨å†Œæ–°ç”¨æˆ·æˆåŠŸ

**æ­å–œï¼ç³»ç»Ÿè¿è¡Œæ­£å¸¸ï¼** ğŸš€

---

## ğŸ†˜ éœ€è¦å¸®åŠ©ï¼Ÿ

é‡åˆ°é—®é¢˜ï¼Ÿæ£€æŸ¥ï¼š
1. Redisæ˜¯å¦è¿è¡Œ: `redis-cli ping`
2. æ•°æ®åº“æ˜¯å¦è¿æ¥: æŸ¥çœ‹å¯åŠ¨æ—¥å¿—
3. åˆå§‹åŒ–è„šæœ¬æ˜¯å¦æ‰§è¡Œ: æŸ¥è¯¢ `platform_admins` è¡¨
4. åº”ç”¨æ˜¯å¦æˆåŠŸå¯åŠ¨: è®¿é—® http://localhost:10010/actuator/health

å…¨éƒ¨æ­£å¸¸ä½†è¿˜æœ‰é—®é¢˜ï¼ŸæŸ¥çœ‹ `logs/cretas-backend.log`
